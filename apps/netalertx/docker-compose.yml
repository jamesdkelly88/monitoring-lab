services:
  netalertx:
    container_name: netalertx
    image: ghcr.io/netalertx/netalertx:26.2.6
    network_mode: host
    read_only: true                                 # Make the container filesystem read-only
    cap_drop:                                       # Drop all capabilities for enhanced security
      - ALL
    cap_add:                                        # Add only the necessary capabilities
      - NET_ADMIN                                   # Required for ARP scanning
      - NET_RAW                                     # Required for raw socket operations
      - NET_BIND_SERVICE                            # Required to bind to privileged ports (nbtscan)
      - CHOWN                                       # Required for root-entrypoint to chown /data + /tmp before dropping privileges
      - SETUID                                      # Required for root-entrypoint to switch to non-root user
      - SETGID                                      # Required for root-entrypoint to switch to non-root group
    volumes:
      - data:/data                                  # Persistent Docker-managed named volume for config + database
      - /etc/localtime:/etc/localtime:ro            # Bind mount for timezone consistency
    # tmpfs mount consolidates writable state for a read-only container and improves performance
    # uid/gid default to the service user (20211)
    # mode=1700 grants rwx------ permissions to the runtime user only
    tmpfs:
      - "/tmp:uid=20211,gid=20211,mode=1700,rw,noexec,nosuid,nodev,async,noatime,nodiratime"
    environment:
      LISTEN_ADDR: 0.0.0.0                          # Listen for connections on all interfaces
      PORT: 20211                                   # Application port
      GRAPHQL_PORT: 20212                           # GraphQL API port (passed into APP_CONF_OVERRIDE at runtime)
    mem_limit: 2048m                                # Maximum memory usage
    mem_reservation: 1024m                          # Soft memory limit
    cpu_shares: 512                                 # Relative CPU weight for CPU contention scenarios
    pids_limit: 512                                 # Limit the number of processes/threads to prevent fork bombs
    restart: unless-stopped

volumes:
  data: